using UnityEngine;
using System.Collections;

public class ShapeTracker : MonoBehaviour {
	
	
	public int[] cargoBay;
	public int cargoBaySize = 5;
	
	private Variables vars;
	
	public Timer timer;
	public Button button;
	
	// Use this for initialization
	void Start () {
		//button.gameObject.SetActive (false);
		GameObject v1 = GameObject.FindGameObjectWithTag ("Variables");
		vars = v1.GetComponent<Variables> ();

		cargoBay  = new int [cargoBaySize];
		
	}
	
	
	
	//When shape hits player.
	void OnTriggerEnter2D (Collider2D obj)  {
		
		string name = obj.gameObject.tag;
		
		//square
		if (name == "Shape01") {			
			CargoBay(1);
		}
		//circle
		if (name == "Shape02") {			
			CargoBay(2);
		}
		//triangle
		if (name == "Shape03") {			
			CargoBay(3);
		}
		//diamond
		if (name == "Shape04") {			
			CargoBay(4);
		}
		//star
		if (name == "Shape05") {			
			CargoBay(5);
		}
		//bonus shape adds a little time
		//if (name == "Shape07") {			
		//		CargoBay(7);	
		//}



		ActiveButton();
		
		
		
		
	}
	
	void CargoBay(int shapeNum){
		
		//First in First out loop to track the shapes in cargoBay.
		for ( int i = 0; i < cargoBaySize; i++)
		{
			if (cargoBay[i] == 0){
				cargoBay[i] = shapeNum;
				//Debug.Log(cargoBay[i] + " Added");
				Debug.Log(cargoBay[0] + " " +cargoBay[1] +" " +cargoBay[2] +" " +cargoBay[3] +" " +cargoBay[4] );
				break;
			}

			//If cargoBay is full, remove oldest
			else if (cargoBay[cargoBaySize - 1] != 0)
			{


				for ( int n = 0; n < cargoBaySize; n++)
				{
					//move over the left most shapes, and remove the oldest
					if (n <  (cargoBaySize - 1)  ){

						if (n == 0 ){
							//Adds the oldest shapes's value to infection.  Making overflowing a bad move!
							vars.winningScore += cargoBay[0];
						}

						cargoBay[n] = cargoBay[n+1];

						//Debug.Log (cargoBay[n] + "replaced with " + cargoBay[n+1]);
						//Debug.Log(cargoBay[0] + " " +cargoBay[1] +" " +cargoBay[2] +" " +cargoBay[3] +" " +cargoBay[4] );

					}
					//The newest shape fills in
					else {
						cargoBay[cargoBaySize - 1] = shapeNum;

						Debug.Log(cargoBay[0] + " " +cargoBay[1] +" " +cargoBay[2] +" " +cargoBay[3] +" " +cargoBay[4] );
						break;
					}
					
				}
				break;
			}
		}
		// Check if 3 of same shape are touching
		//for (int i = 0; i < cargoBaySize; i++) {
		//		}

		
	}
	
	//Activate the button when cargo bay is full
	void ActiveButton(){
		int count = cargoBaySize;
		//CargoBay is full
		for ( int i = 0; i < cargoBaySize; i++)
		{
			if (cargoBay[i] != 0){
				count--;
			}
		}

		if (count == 0) {
			button.gameObject.SetActive	(true);
				}
		
		
	}
}
