using UnityEngine;
using System.Collections;
using System.Collections.Generic;

public class ShapeSpawn : MonoBehaviour {

	private Variables vars;

	//spawnTime may be changed into multiple floats for the InvokeRepeating command
	private float spawnTime;
	public GameObject shapeObject;

	//The spawn locations
	public Transform spawn01,spawn02,spawn03,spawn04,spawn05,spawn06;
	private int spawnNumber;

	//tota number of shapes
	private int pooledAmount;
	List<GameObject> shapesQueue;

	//May need to change this to Update() in order to allow variable changing mid game.
	void Start () {

		//Variables
		GameObject v1 = GameObject.FindGameObjectWithTag ("Variables");
		vars = v1.GetComponent<Variables> ();
		

		spawnTime = vars.spawnTimeV;
		pooledAmount = vars.pooledAmountV;

		//The Shapes queue pool	
		shapesQueue = new List<GameObject>();
		ShapeObjectPool (vars.pooledAmountV);


		//InvokeSpawn ();

	}

	void Update(){

		//If active shapes count > 0 then don't spawn shapes

		if (spawnTime != vars.spawnTimeV) {
			CancelInvoke("Spawn");
			spawnTime = vars.spawnTimeV;
			Invoke ("InvokeSpawn", .6f);
		}
		

	}

	void ShapeObjectPool(){

		for (int i = 0; i < vars.pooledAmountV; i++) {
			
			GameObject obj = (GameObject)Instantiate(shapeObject);
			shapesQueue.Add(obj);
			//Code for adding the objects to an array
			obj.SetActive(false);
			
			
		}
	
	}

	void InvokeSpawn(){

		InvokeRepeating ("Spawn", spawnTime, spawnTime);

		}


	void Spawn () {
	
		for (int i = 0; i < shapesQueue.Count; i++) {

			if(!shapesQueue[i].activeInHierarchy)
			{
				
				DetermineSpawnNumber(shapesQueue[i]);
			

				shapesQueue[i].SetActive(true);
				break;
			}

		}

	}

	//random number generator for spawn loc
	void DetermineSpawnNumber(GameObject shape){
		spawnNumber = Mathf.RoundToInt(Random.Range(1,7));
		SpawnLocation (spawnNumber, shape);
		
		
	}

	//picks spawn location
	void SpawnLocation (int number, GameObject shape){
		
		if (number == 1){
			shape.transform.position = spawn01.position;
		}
		else if (number == 2 ){
			shape.transform.position = spawn02.position;
		}
		else if (number == 3 ){
			shape.transform.position = spawn03.position;
		}
		else if (number == 4 ){
			shape.transform.position = spawn04.position;
		}
		else if (number == 5 ){
			shape.transform.position = spawn05.position;
		}
		else if (number > 5 ) {
			shape.transform.position = spawn06.position;
		} 
		
	}
}
